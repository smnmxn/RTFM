<% content_for(:title) { "Ask - #{@project.name} Help Centre" } %>

<div class="space-y-8">
  <!-- Breadcrumb -->
  <nav class="text-sm">
    <%= link_to "Help Centre",
        help_centre_path,
        class: "text-brand hover:opacity-80" %>
    <span class="mx-2 text-gray-400">/</span>
    <span class="text-gray-600">Ask</span>
  </nav>

  <!-- Question -->
  <div class="max-w-3xl">
    <h1 class="text-2xl font-bold text-gray-900 mb-2">
      <%= @question %>
    </h1>
  </div>

  <!-- Answer -->
  <div class="max-w-3xl">
    <% if @result[:error] %>
      <!-- Error State -->
      <div class="bg-red-50 border border-red-200 rounded-xl p-6">
        <div class="flex items-start gap-3">
          <%= heroicon "exclamation-circle", options: { class: "w-6 h-6 text-red-500 flex-shrink-0 mt-0.5" } %>
          <div>
            <p class="text-red-800 font-medium"><%= @result[:error] %></p>
            <p class="text-red-600 text-sm mt-2">
              Try browsing our
              <%= link_to "help articles", help_centre_path, class: "underline hover:no-underline" %>
              instead.
            </p>
          </div>
        </div>
      </div>
    <% else %>
      <!-- Answer Card -->
      <div class="bg-white shadow-sm border border-gray-200 rounded-xl overflow-hidden">
        <div class="px-6 py-4 bg-gradient-to-r from-brand/5 to-transparent border-b border-gray-100">
          <div class="flex items-center gap-2 text-sm text-gray-600">
            <%= heroicon "sparkles", options: { class: "w-4 h-4 text-brand" } %>
            <span>AI-generated answer</span>
          </div>
        </div>
        <div class="px-6 py-6">
          <div class="prose prose-gray max-w-none prose-a:text-brand prose-a:no-underline hover:prose-a:underline">
            <%= markdown(@result[:answer]) %>
          </div>
        </div>
      </div>

      <!-- Sources -->
      <% if @result[:sources].any? %>
        <div class="mt-8">
          <h2 class="text-lg font-semibold text-gray-900 mb-4">Sources</h2>
          <div class="grid gap-3 sm:grid-cols-2">
            <% @result[:sources].each do |source| %>
              <%= link_to source[:url], class: "group block bg-white border border-gray-200 rounded-lg p-4 hover:border-brand hover:shadow-sm transition-all" do %>
                <div class="flex items-start gap-3">
                  <%= heroicon "document-text", options: { class: "w-5 h-5 text-gray-400 group-hover:text-brand flex-shrink-0 mt-0.5 transition-colors" } %>
                  <div>
                    <p class="font-medium text-gray-900 group-hover:text-brand transition-colors"><%= source[:title] %></p>
                    <% if source[:section] %>
                      <p class="text-sm text-gray-500 mt-0.5"><%= source[:section] %></p>
                    <% end %>
                  </div>
                </div>
              <% end %>
            <% end %>
          </div>
        </div>
      <% end %>
    <% end %>

    <!-- Ask Another Question -->
    <div class="mt-8 pt-8 border-t border-gray-200">
      <p class="text-gray-600 mb-4">Have another question?</p>
      <%= form_with url: help_centre_ask_path, method: :get, class: "max-w-xl" do %>
        <div class="flex gap-3">
          <input type="text"
                 name="q"
                 placeholder="Ask a question..."
                 class="flex-1 px-4 py-3 border border-gray-300 rounded-lg
                        focus:ring-2 focus:ring-brand focus:border-brand
                        placeholder:text-gray-400">
          <button type="submit"
                  class="px-5 py-3 bg-brand text-white rounded-lg hover:opacity-90 transition-opacity font-medium">
            Ask
          </button>
        </div>
      <% end %>
    </div>

    <!-- Browse Categories -->
    <div class="mt-6 text-center">
      <p class="text-sm text-gray-500">
        Or <%= link_to "browse all categories", help_centre_path, class: "text-brand hover:underline" %>
      </p>
    </div>
  </div>
</div>
