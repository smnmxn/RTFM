<%= turbo_frame_tag "pull_request_list" do %>
  <div class="divide-y divide-app-border">
    <% if @pull_requests.empty? %>
      <div class="p-6 text-center app-text-secondary">
        <p>No merged pull requests found.</p>
      </div>
    <% else %>
      <% # Preload updates for efficiency %>
      <% updates_by_pr = @project.updates.where(pull_request_number: @pull_requests.map { |pr| pr[:number] }).index_by(&:pull_request_number) %>

      <% @pull_requests.each do |pr| %>
        <% existing_update = updates_by_pr[pr[:number]] %>
        <div class="p-4 hover:app-surface-alt">
          <div class="flex items-start gap-3">
            <img src="<%= pr[:user][:avatar_url] %>" alt="<%= pr[:user][:login] %>" class="w-8 h-8 rounded-full flex-shrink-0">
            <div class="flex-1 min-w-0">
              <div class="flex items-center gap-2">
                <%= link_to pr[:html_url], target: "_blank", class: "font-medium app-text hover:app-accent-text truncate" do %>
                  <%= pr[:title] %>
                <% end %>
              </div>
              <p class="text-sm app-text-secondary">
                #<%= pr[:number] %> merged <%= time_ago_in_words(pr[:merged_at]) %> ago by <%= pr[:user][:login] %>
              </p>
            </div>
            <%= render "updates/pr_row_actions",
                update: existing_update,
                project: @project,
                pr_number: pr[:number],
                pr_title: pr[:title],
                pr_url: pr[:html_url] %>
          </div>
        </div>
      <% end %>

      <% if @has_more %>
        <div class="p-4 text-center">
          <%= link_to "Load more pull requests",
              pull_requests_project_path(@project, page: @page + 1),
              class: "app-accent-text hover:app-accent-hover",
              data: { turbo_frame: "pull_request_list" } %>
        </div>
      <% end %>
    <% end %>
  </div>
<% end %>
