<div id="suggestion_<%= suggestion.id %>"
     class="p-3 rounded-lg border <%= suggestion.suggestion_pending? ? 'app-surface app-border' : 'app-surface-alt app-border' %>">
  <div class="flex items-start justify-between gap-4">
    <div class="flex-1 min-w-0">
      <div class="flex items-center gap-2 flex-wrap">
        <!-- Type Badge -->
        <% if suggestion.suggestion_type_update_needed? %>
          <span class="inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-medium bg-orange-100 text-orange-700">
            <%= heroicon "pencil-square", options: { class: "w-3 h-3" } %>
            Update Needed
          </span>
        <% else %>
          <span class="inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-700">
            <%= heroicon "document-plus", options: { class: "w-3 h-3" } %>
            New Article
          </span>
        <% end %>

        <!-- Priority Badge -->
        <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium <%= suggestion.priority_badge_classes %>">
          <%= suggestion.priority.capitalize %>
        </span>

        <!-- Status Badge (if not pending) -->
        <% unless suggestion.suggestion_pending? %>
          <% if suggestion.suggestion_accepted? %>
            <span class="inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-700">
              <%= heroicon "check", options: { class: "w-3 h-3" } %>
              Accepted
            </span>
          <% else %>
            <span class="inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-medium app-surface-alt app-text-secondary">
              <%= heroicon "x-mark", options: { class: "w-3 h-3" } %>
              Dismissed
            </span>
          <% end %>
        <% end %>
      </div>

      <!-- Article Title / Suggested Title -->
      <div class="mt-2">
        <% if suggestion.article.present? %>
          <p class="text-sm font-medium app-text"><%= suggestion.article.title %></p>
        <% elsif suggestion.suggested_changes.is_a?(Hash) && suggestion.suggested_changes["suggested_title"] %>
          <p class="text-sm font-medium app-text"><%= suggestion.suggested_changes["suggested_title"] %></p>
        <% end %>
      </div>

      <!-- Reason -->
      <% if suggestion.reason.present? %>
        <p class="mt-1 text-sm app-text-secondary"><%= suggestion.reason %></p>
      <% end %>

      <!-- Affected Files -->
      <% if suggestion.affected_files.present? && suggestion.affected_files.any? %>
        <div class="mt-2 flex items-center gap-2 flex-wrap">
          <span class="text-xs app-text-secondary">Files:</span>
          <% suggestion.affected_files.first(3).each do |file| %>
            <code class="px-1 py-0.5 app-surface-alt rounded text-xs font-mono app-text-secondary truncate max-w-xs"><%= file.split('/').last %></code>
          <% end %>
          <% if suggestion.affected_files.size > 3 %>
            <span class="text-xs app-text-muted">+<%= suggestion.affected_files.size - 3 %> more</span>
          <% end %>
        </div>
      <% end %>

      <!-- Suggested Changes Details -->
      <% if suggestion.suggested_changes.is_a?(Hash) %>
        <% if suggestion.suggestion_type_update_needed? %>
          <% changes = suggestion.suggested_changes %>
          <div class="mt-2 text-xs app-text-secondary">
            <% notes = [] %>
            <% notes << "Update steps: #{changes['update_steps'].join(', ')}" if changes['update_steps'].present? %>
            <% notes << "Update introduction" if changes['update_introduction'] %>
            <% notes << "Add prerequisite" if changes['add_prerequisite'] %>
            <% notes << changes['notes'] if changes['notes'].present? %>
            <%= notes.join(' | ') %>
          </div>
        <% elsif suggestion.suggestion_type_new_article? %>
          <% changes = suggestion.suggested_changes %>
          <% if changes["suggested_section"].present? %>
            <div class="mt-2 text-xs app-text-secondary">
              Suggested section: <span class="font-medium"><%= changes["suggested_section"] %></span>
            </div>
          <% end %>
          <% if changes["key_features"].present? %>
            <div class="mt-1 flex items-center gap-1 flex-wrap">
              <% changes["key_features"].each do |feature| %>
                <span class="px-2 py-0.5 bg-blue-50 text-blue-700 rounded text-xs"><%= feature %></span>
              <% end %>
            </div>
          <% end %>
        <% end %>
      <% end %>
    </div>

    <!-- Actions -->
    <% if suggestion.suggestion_pending? %>
      <div class="flex items-center gap-2 flex-shrink-0">
        <%= button_to accept_project_article_update_suggestion_path(suggestion.article_update_check.project, suggestion),
                      method: :post,
                      class: "inline-flex items-center gap-1 px-2 py-1 text-xs font-medium text-green-700 bg-green-50 rounded hover:bg-green-100 focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-green-500",
                      title: suggestion.suggestion_type_new_article? ? "Create recommendation in inbox" : "Flag article for regeneration",
                      data: { turbo_method: :post } do %>
          <%= heroicon "check", options: { class: "w-3 h-3" } %>
          <%= suggestion.suggestion_type_new_article? ? "Create" : "Flag" %>
        <% end %>
        <%= button_to dismiss_project_article_update_suggestion_path(suggestion.article_update_check.project, suggestion),
                      method: :post,
                      class: "inline-flex items-center gap-1 px-2 py-1 text-xs font-medium app-text-secondary app-surface-alt rounded hover:app-surface-alt focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-[color:var(--app-focus-ring)]",
                      data: { turbo_method: :post } do %>
          <%= heroicon "x-mark", options: { class: "w-3 h-3" } %>
          Dismiss
        <% end %>
      </div>
    <% end %>
  </div>
</div>
