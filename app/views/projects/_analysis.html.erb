<div id="<%= dom_id(project, :analysis) %>" class="app-surface shadow rounded-lg p-6 mb-6">
  <div class="flex justify-between items-start">
    <div>
      <h3 class="text-lg font-semibold app-text">Project Overview</h3>
      <% if project.analysis_status == "completed" && project.project_overview.present? %>
        <p class="mt-2 app-text-secondary"><%= project.project_overview %></p>
        <p class="mt-3 text-xs app-text-secondary">
          Last analyzed: <%= time_ago_in_words(project.analyzed_at) %> ago
          <% if project.analysis_commit_sha.present? %>
            Â· Commit: <code class="text-xs app-surface-alt px-1 py-0.5 rounded"><%= project.analysis_commit_sha[0..7] %></code>
          <% end %>
        </p>
      <% elsif project.analysis_status == "failed" %>
        <p class="mt-2 text-sm text-red-600">
          Analysis failed. Please try again.
        </p>
      <% elsif project.analysis_status == "running" || project.analysis_status == "pending" %>
        <p class="mt-2 text-sm text-yellow-700">
<span class="inline-flex items-center">
            <%= spinner_icon(size: "h-4 w-4", extra_class: "-ml-1 mr-2") %>
            <%= project.analysis_status == "pending" ? "Analysis queued..." : "Analyzing repository..." %>
          </span>
        </p>
      <% else %>
        <p class="mt-2 text-sm app-text-secondary">
          Analyze this repository to generate an overview.
        </p>
      <% end %>
    </div>
    <div class="flex-shrink-0 ml-4">
      <% if project.analysis_status == "running" || project.analysis_status == "pending" %>
        <!-- No button while running -->
      <% elsif project.analysis_status == "completed" %>
        <%= button_to "Re-analyze", analyze_project_path(project),
            class: "inline-flex items-center px-3 py-1.5 border app-border-strong shadow-sm text-sm font-medium rounded-md app-text app-surface hover:app-surface-alt",
            data: { turbo_frame: "_top" } %>
      <% elsif project.analysis_status == "failed" %>
        <%= button_to "Retry", analyze_project_path(project),
            class: "inline-flex items-center px-3 py-1.5 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-red-600 hover:bg-red-700",
            data: { turbo_frame: "_top" } %>
      <% else %>
        <%= button_to "Analyze", analyze_project_path(project),
            class: "inline-flex items-center px-3 py-1.5 border border-transparent shadow-sm text-sm font-medium rounded-md text-white app-accent-bg hover:app-accent-bg",
            data: { turbo_frame: "_top" } %>
      <% end %>
    </div>
  </div>
</div>
