<div class="min-h-screen bg-gray-50">
  <!-- Header -->
  <header class="bg-white shadow-sm">
    <div class="max-w-7xl mx-auto px-4 py-4 sm:px-6 lg:px-8 flex justify-between items-center">
      <h1 class="text-2xl font-bold text-gray-900">Ship & Shout</h1>
      <div class="flex items-center gap-4">
        <%= link_to "Back to Dashboard", dashboard_path, class: "text-indigo-600 hover:text-indigo-800" %>
      </div>
    </div>
  </header>

  <main class="max-w-4xl mx-auto px-4 py-8 sm:px-6 lg:px-8">
    <!-- Project Header -->
    <div class="bg-white shadow rounded-lg p-6 mb-6">
      <div class="flex justify-between items-start">
        <div>
          <h2 class="text-2xl font-semibold text-gray-900"><%= @project.name %></h2>
          <p class="mt-1 text-gray-500">
            <%= link_to @project.github_repo, "https://github.com/#{@project.github_repo}", target: "_blank", class: "hover:text-indigo-600" %>
          </p>
        </div>
        <div class="text-right">
          <span class="text-sm text-gray-500">
            <%= @project.updates.count %> changelog updates
          </span>
        </div>
      </div>
    </div>

    <!-- Subscribe to analysis updates -->
    <%= turbo_stream_from @project, :analysis %>
    <%= turbo_stream_from @project, :updates %>

    <!-- Codebase Analysis -->
    <%= render "projects/analysis", project: @project %>

    <!-- Recommended Support Articles -->
    <%= render "recommendations/list", recommendations: @project.recommendations.pending, project: @project %>

    <!-- Generated Articles -->
    <%= render "articles/list", articles: @project.articles.order(created_at: :desc) %>

    <!-- Updates / Changelogs -->
    <% if @project.updates.any? %>
      <div class="bg-white shadow rounded-lg mb-6">
        <div class="px-6 py-4 border-b border-gray-200">
          <h3 class="text-lg font-semibold text-gray-900">Changelog Updates</h3>
          <p class="mt-1 text-sm text-gray-500">
            AI-generated changelogs from merged pull requests
          </p>
        </div>
        <div class="divide-y divide-gray-200">
          <% @project.updates.order(created_at: :desc).each do |update| %>
            <%= render "updates/card", update: update %>
          <% end %>
        </div>
      </div>
    <% end %>

    <!-- Pull Requests -->
    <div class="bg-white shadow rounded-lg">
      <div class="px-6 py-4 border-b border-gray-200">
        <h3 class="text-lg font-semibold text-gray-900">Merged Pull Requests</h3>
        <p class="mt-1 text-sm text-gray-500">
          Recent merged PRs from this repository
        </p>
      </div>

      <%= turbo_frame_tag "pull_request_list", src: pull_requests_project_path(@project), loading: :lazy do %>
        <div class="p-6 text-center">
          <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600 mx-auto"></div>
          <p class="mt-2 text-sm text-gray-500">Loading pull requests...</p>
        </div>
      <% end %>
    </div>
  </main>
</div>
