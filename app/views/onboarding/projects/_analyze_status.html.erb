<% case project.analysis_status %>
<% when nil, "" %>
  <div class="text-center py-8">
    <p class="text-slate-600 mb-4">Ready to analyze your codebase.</p>
    <%= button_to "Start Analysis",
        start_analysis_onboarding_project_path(project),
        method: :post,
        class: "px-6 py-3 bg-gradient-brand text-white font-medium rounded-lg hover:opacity-90 transition-smooth" %>
  </div>

<% when "pending", "running" %>
  <div class="px-4 py-3 bg-gradient-brand text-white text-sm flex items-center justify-center rounded-t-lg -mt-6 -mx-6 mb-6">
    <svg class="animate-spin h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24">
      <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
      <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
    </svg>
    Analyzing...
  </div>
  <%= render "onboarding/projects/analysis_questions", project: project %>

<% when "completed" %>
  <% if project.sections_being_generated? %>
    <div class="px-4 py-3 bg-gradient-brand text-white text-sm flex items-center justify-center rounded-t-lg -mt-6 -mx-6 mb-6">
      <svg class="animate-spin h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24">
        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
      </svg>
      Generating suggestions...
    </div>
    <% if project.contextual_questions.present? %>
      <%= render "onboarding/projects/contextual_questions", project: project %>
    <% else %>
      <div class="py-8 text-center text-slate-500">Almost there...</div>
    <% end %>
  <% elsif project.sections.pending.any? || project.sections.accepted.any? %>
    <script>
      window.location.href = "<%= sections_onboarding_project_path(project) %>";
    </script>
    <div class="text-center py-8">
      <p class="text-slate-600">Redirecting...</p>
    </div>
  <% elsif project.sections_generation_status == "failed" %>
    <div class="text-center py-8">
      <p class="text-amber-600 mb-4">Couldn't generate suggestions automatically.</p>
      <%= link_to "Continue",
          sections_onboarding_project_path(project),
          class: "px-6 py-3 bg-gradient-brand text-white font-medium rounded-lg hover:opacity-90 transition-smooth" %>
    </div>
  <% else %>
    <div class="px-4 py-3 bg-gradient-brand text-white text-sm flex items-center justify-center rounded-t-lg -mt-6 -mx-6 mb-6">
      <svg class="animate-spin h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24">
        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
      </svg>
      Preparing suggestions...
    </div>
    <% if project.contextual_questions.present? %>
      <%= render "onboarding/projects/contextual_questions", project: project %>
    <% else %>
      <div class="py-8 text-center text-slate-500">Almost there...</div>
    <% end %>
  <% end %>

<% when "failed" %>
  <div class="text-center py-8">
    <p class="text-red-600 mb-4">Analysis failed. Please try again.</p>
    <%= button_to "Retry",
        start_analysis_onboarding_project_path(project),
        method: :post,
        class: "px-6 py-3 bg-red-600 text-white font-medium rounded-lg hover:bg-red-700 transition-smooth" %>
  </div>
<% end %>
