<div id="<%= dom_id(project, :onboarding_analyze) %>" class="p-6">
<% case project.analysis_status %>
<% when nil, "" %>
  <div class="text-center py-8">
    <p class="text-slate-600 mb-4">Ready to analyze your codebase.</p>
    <%= button_to "Start Analysis",
        start_analysis_onboarding_project_path(project),
        method: :post,
        class: "px-6 py-3 bg-gradient-brand text-white font-medium rounded-lg hover:opacity-90 transition-smooth" %>
  </div>

<% when "pending", "running" %>
<div class="px-4 py-3 bg-gradient-brand text-white text-sm flex items-center justify-center rounded-t-lg -mt-6 -mx-6 mb-6">
    <%= spinner_icon(size: "h-4 w-4", extra_class: "mr-2") %>
    Analyzing your codebase...
  </div>
  <%= render "onboarding/projects/analysis_questions", project: project %>

<% when "completed" %>
  <% if project.sections_being_generated? %>
<div class="px-4 py-3 bg-gradient-brand text-white text-sm flex items-center justify-center rounded-t-lg -mt-6 -mx-6 mb-6">
      <%= spinner_icon(size: "h-4 w-4", extra_class: "mr-2") %>
      Generating help topic suggestions...
    </div>
    <% if project.contextual_questions.present? %>
      <%= render "onboarding/projects/contextual_questions", project: project %>
    <% else %>
      <div class="py-8 text-center text-slate-500">Almost there...</div>
    <% end %>
  <% elsif project.sections.pending.any? || project.sections.accepted.any? %>
    <div class="text-center py-8"
         data-controller="redirect"
         data-redirect-url-value="<%= sections_onboarding_project_path(project) %>">
      <p class="text-slate-600">Redirecting...</p>
    </div>
  <% elsif project.sections_generation_status == "failed" %>
    <div class="text-center py-8">
      <p class="text-amber-600 mb-4">Couldn't generate suggestions automatically.</p>
      <div class="flex justify-center gap-3">
        <%= button_to "Retry",
            retry_sections_onboarding_project_path(project),
            method: :post,
            class: "px-6 py-3 bg-amber-600 text-white font-medium rounded-lg hover:bg-amber-700 transition-smooth" %>
        <%= link_to "Continue Manually",
            sections_onboarding_project_path(project),
            class: "px-6 py-3 bg-slate-200 text-slate-700 font-medium rounded-lg hover:bg-slate-300 transition-smooth" %>
      </div>
    </div>
  <% else %>
<div class="px-4 py-3 bg-gradient-brand text-white text-sm flex items-center justify-center rounded-t-lg -mt-6 -mx-6 mb-6">
      <%= spinner_icon(size: "h-4 w-4", extra_class: "mr-2") %>
      Preparing suggestions...
    </div>
    <% if project.contextual_questions.present? %>
      <%= render "onboarding/projects/contextual_questions", project: project %>
    <% else %>
      <div class="py-8 text-center text-slate-500">Almost there...</div>
    <% end %>
  <% end %>

<% when "failed" %>
  <div class="text-center py-8">
    <p class="text-red-600 mb-4">Analysis failed. Please try again.</p>
    <%= button_to "Retry",
        start_analysis_onboarding_project_path(project),
        method: :post,
        class: "px-6 py-3 bg-red-600 text-white font-medium rounded-lg hover:bg-red-700 transition-smooth" %>
  </div>
<% end %>
</div>
