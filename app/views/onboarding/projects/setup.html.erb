<div class="app-surface app-shadow-sm rounded-xl app-border overflow-hidden">
  <%= render "onboarding/shared/step_header",
      title: "Set up your help centre",
      subtitle: "Choose a name, URL, and which branch to track for each repository." %>

  <div class="p-6">
    <%= form_with url: save_setup_onboarding_project_path(@project), method: :post, class: "space-y-6" do |f| %>
      <div>
        <label for="project_name" class="block text-sm font-medium app-text-secondary mb-1">Project name</label>
        <input type="text" name="project[name]" id="project_name"
               value="<%= @project.name == 'New Project' ? '' : @project.name %>"
               class="w-full px-3 py-2 app-input rounded-lg"
               placeholder="My App"
               autofocus
               required />
        <p class="mt-1 text-xs app-text-secondary">This will be displayed in your help centre header.</p>
        <% if @project.errors[:name].any? %>
          <p class="mt-1 text-xs text-red-600"><%= @project.errors[:name].first %></p>
        <% end %>
      </div>

      <div>
        <label for="project_subdomain" class="block text-sm font-medium app-text-secondary mb-1">Subdomain</label>
        <div class="flex items-stretch">
          <input type="text" name="project[subdomain]" id="project_subdomain"
                 value="<%= @project.subdomain %>"
                 class="flex-1 px-3 py-2 app-input rounded-l-lg"
                 placeholder="my-app"
                 pattern="[a-z0-9][a-z0-9-]*[a-z0-9]"
                 minlength="3"
                 maxlength="63"
                 required />
          <span class="px-3 flex items-center app-surface-alt border border-l-0 app-border-strong rounded-r-lg app-text-secondary text-sm">
            .supportpages.io
          </span>
        </div>
        <p class="mt-1 text-xs app-text-secondary">Lowercase letters, numbers, and hyphens only. This will be your help centre URL.</p>
        <% if @project.errors[:subdomain].any? %>
          <p class="mt-1 text-xs text-red-600"><%= @project.errors[:subdomain].first %></p>
        <% end %>
        <% if @project.errors[:slug].any? %>
          <p class="mt-1 text-xs text-red-600"><%= @project.errors[:slug].first %></p>
        <% end %>
      </div>

      <!-- Support Contact (Optional) -->
      <div class="border-t app-border pt-6">
        <h3 class="text-sm font-medium app-text-secondary mb-1">Support Contact <span class="app-text-muted font-normal">(optional)</span></h3>
        <p class="text-xs app-text-secondary mb-4">Give visitors a way to reach you if they can't find what they need. These will appear in your help centre header and after articles.</p>

        <div class="space-y-4">
          <div>
            <label for="project_support_email" class="block text-sm font-medium app-text-secondary mb-1">Email</label>
            <input type="email" name="project[support_email]" id="project_support_email"
                   value="<%= @project.support_email %>"
                   class="w-full px-3 py-2 app-input rounded-lg"
                   placeholder="support@yourcompany.com" />
          </div>

          <div>
            <label for="project_support_phone" class="block text-sm font-medium app-text-secondary mb-1">Phone</label>
            <input type="tel" name="project[support_phone]" id="project_support_phone"
                   value="<%= @project.support_phone %>"
                   class="w-full px-3 py-2 app-input rounded-lg"
                   placeholder="+1 (555) 123-4567" />
          </div>
        </div>
      </div>

      <% if @project_repositories.any? %>
        <div class="border-t app-border pt-6">
          <h3 class="text-sm font-medium app-text-secondary mb-3">Branch to track</h3>
          <p class="text-xs app-text-secondary mb-4">Choose which branch to monitor for each repository. Only pull requests merged into this branch will trigger documentation updates.</p>

          <div class="space-y-4">
            <% @project_repositories.each do |pr| %>
              <% repo_data = @branches_by_repo[pr.id] || { branches: [], default_branch: nil } %>
              <div class="flex items-center gap-4">
                <div class="flex-1 min-w-0">
                  <span class="text-sm font-medium app-text truncate block"><%= pr.github_repo %></span>
                </div>
                <div class="w-48">
                  <% if repo_data[:branches].any? %>
                    <select name="repo_branches[<%= pr.id %>]"
                            class="w-full appearance-none h-[38px] px-3 pr-8 app-input rounded-lg text-sm bg-[url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%2020%2020%22%20fill%3D%22%2364748b%22%3E%3Cpath%20fill-rule%3D%22evenodd%22%20d%3D%22M5.22%208.22a.75.75%200%20011.06%200L10%2011.94l3.72-3.72a.75.75%200%20111.06%201.06l-4.25%204.25a.75.75%200%2001-1.06%200L5.22%209.28a.75.75%200%20010-1.06z%22%20clip-rule%3D%22evenodd%22%2F%3E%3C%2Fsvg%3E')] bg-[length:1.25rem_1.25rem] bg-[position:right_0.5rem_center] bg-no-repeat cursor-pointer">
                      <% repo_data[:branches].each do |branch| %>
                        <option value="<%= branch %>"
                                <%= 'selected' if branch == (pr.branch || repo_data[:default_branch]) %>>
                          <%= branch %><%= ' (default)' if branch == repo_data[:default_branch] %>
                        </option>
                      <% end %>
                    </select>
                  <% else %>
                    <input type="text" name="repo_branches[<%= pr.id %>]"
                           value="<%= pr.branch || 'main' %>"
                           class="w-full px-3 py-2 app-input rounded-lg text-sm"
                           placeholder="main" />
                    <p class="mt-1 text-xs app-text-muted">Could not load branches</p>
                  <% end %>
                </div>
              </div>
            <% end %>
          </div>
        </div>
      <% end %>

      <div class="pt-4">
        <button type="submit" class="w-full btn-primary-lg cursor-pointer">Continue</button>
      </div>
    <% end %>
  </div>
</div>
