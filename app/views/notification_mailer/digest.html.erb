<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; margin: 0; padding: 0; background-color: #f8fafc; color: #1e293b; -webkit-text-size-adjust: 100%;">
  <div style="max-width: 560px; margin: 0 auto; padding: 32px 16px;">
    <%# Brand header %>
    <div style="text-align: left; margin-bottom: 24px;">
      <%= image_tag "logo.png", style: "height: 40px;", alt: "supportpages.io" %>
    </div>

    <%# Main card %>
    <div style="background: #ffffff; border-radius: 8px; border: 1px solid #e2e8f0; overflow: hidden;">
      <%# Card header %>
      <div style="padding: 20px 24px 16px;">
        <div style="font-size: 18px; font-weight: 600; color: #0f172a; margin-bottom: 2px;"><%= @project.name %></div>
        <div style="font-size: 13px; color: #94a3b8;">
          <% if @failures.any? && @successes.any? %>
            <%= @successes.size %> completed, <%= @failures.size %> failed
          <% elsif @failures.any? %>
            <%= @failures.size %> <%= "task".pluralize(@failures.size) %> failed
          <% else %>
            <%= @successes.size %> <%= "task".pluralize(@successes.size) %> completed
          <% end %>
          &middot; <%= @sent_at.strftime("%-d %b %Y, %-I:%M %p") %>
        </div>
      </div>

      <%# Completed section %>
      <% if @successes.any? %>
        <div style="margin: 0 24px 16px; border-left: 3px solid #22c55e; background: #f0fdf4; border-radius: 0 6px 6px 0; padding: 12px 16px;">
          <div style="font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; color: #15803d; margin-bottom: 10px;">Completed</div>
          <% @successes.each_with_index do |notification, i| %>
            <div style="<%= i > 0 ? 'margin-top: 10px; padding-top: 10px; border-top: 1px solid #dcfce7;' : '' %>">
              <div style="font-size: 14px; color: #1e293b;">&#10003;&ensp;<%= notification.message %></div>
              <% if notification.respond_to?(:detail_text) && notification.detail_text.present? %>
                <div style="font-size: 13px; color: #64748b; margin-top: 2px; padding-left: 22px;"><%= notification.detail_text %></div>
              <% end %>
              <% if notification.respond_to?(:next_step_text) && notification.next_step_text.present? %>
                <div style="font-size: 13px; color: #3f3f46; margin-top: 3px; padding-left: 22px; font-style: italic;"><%= notification.next_step_text %></div>
              <% end %>
            </div>
          <% end %>
        </div>
      <% end %>

      <%# Failed section %>
      <% if @failures.any? %>
        <div style="margin: 0 24px 16px; border-left: 3px solid #ef4444; background: #fef2f2; border-radius: 0 6px 6px 0; padding: 12px 16px;">
          <div style="font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; color: #b91c1c; margin-bottom: 10px;">Failed</div>
          <% @failures.each_with_index do |notification, i| %>
            <div style="<%= i > 0 ? 'margin-top: 10px; padding-top: 10px; border-top: 1px solid #fecaca;' : '' %>">
              <div style="font-size: 14px; color: #1e293b;">&#10007;&ensp;<%= notification.message %></div>
              <% if notification.respond_to?(:detail_text) && notification.detail_text.present? %>
                <div style="font-size: 13px; color: #64748b; margin-top: 2px; padding-left: 22px;"><%= notification.detail_text %></div>
              <% end %>
              <% if notification.respond_to?(:next_step_text) && notification.next_step_text.present? %>
                <div style="font-size: 13px; color: #3f3f46; margin-top: 3px; padding-left: 22px; font-style: italic;"><%= notification.next_step_text %></div>
              <% end %>
            </div>
          <% end %>
        </div>
      <% end %>

      <%# Content preview teaser %>
      <% if @preview.present? %>
        <div style="margin: 0 24px 16px; border-left: 3px solid #3f3f46; background: #f4f4f5; border-radius: 0 6px 6px 0; padding: 12px 16px;">
          <% if @preview[:type] == :article %>
            <div style="font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; color: #3f3f46; margin-bottom: 8px;">Preview</div>
            <div style="font-size: 15px; font-weight: 600; color: #1e293b; margin-bottom: 6px;"><%= @preview[:title] %></div>
            <div style="position: relative; max-height: 80px; overflow: hidden;">
              <div style="font-size: 13px; color: #4b5563; line-height: 1.5;"><%= @preview[:intro] %></div>
              <div style="position: absolute; bottom: 0; left: 0; right: 0; height: 48px; background: linear-gradient(to bottom, rgba(244,244,245,0) 0%, #f4f4f5 100%);"></div>
            </div>
            <div style="margin-top: 8px;">
              <a href="<%= @preview[:url].start_with?("http") ? @preview[:url] : "#{root_url.chomp('/')}#{@preview[:url]}" %>" style="font-size: 13px; color: #3f3f46; text-decoration: none; font-weight: 500;">Read article &rarr;</a>
            </div>
          <% elsif @preview[:type] == :recommendations %>
            <div style="font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; color: #3f3f46; margin-bottom: 8px;">New recommendations</div>
            <% @preview[:titles].each do |title| %>
              <div style="font-size: 13px; color: #4b5563; padding: 2px 0;">&bull;&ensp;<%= title %></div>
            <% end %>
            <div style="margin-top: 8px;">
              <a href="<%= @preview[:url].start_with?("http") ? @preview[:url] : "#{root_url.chomp('/')}#{@preview[:url]}" %>" style="font-size: 13px; color: #3f3f46; text-decoration: none; font-weight: 500;">Review recommendations &rarr;</a>
            </div>
          <% elsif @preview[:type] == :code_review %>
            <div style="font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; color: #3f3f46; margin-bottom: 8px;">Suggested articles</div>
            <% @preview[:titles].each do |title| %>
              <div style="font-size: 13px; color: #4b5563; padding: 2px 0;">&bull;&ensp;<%= title %></div>
            <% end %>
            <div style="margin-top: 8px;">
              <a href="<%= @preview[:url].start_with?("http") ? @preview[:url] : "#{root_url.chomp('/')}#{@preview[:url]}" %>" style="font-size: 13px; color: #3f3f46; text-decoration: none; font-weight: 500;">View code history &rarr;</a>
            </div>
          <% elsif @preview[:type] == :sections %>
            <div style="font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; color: #3f3f46; margin-bottom: 8px;">Suggested sections</div>
            <% @preview[:titles].each do |title| %>
              <div style="font-size: 13px; color: #4b5563; padding: 2px 0;">&bull;&ensp;<%= title %></div>
            <% end %>
            <div style="margin-top: 8px;">
              <a href="<%= @preview[:url].start_with?("http") ? @preview[:url] : "#{root_url.chomp('/')}#{@preview[:url]}" %>" style="font-size: 13px; color: #3f3f46; text-decoration: none; font-weight: 500;">Choose your sections &rarr;</a>
            </div>
          <% end %>
        </div>
      <% end %>

      <%# CTA button %>
      <div style="padding: 8px 24px 24px; text-align: center;">
        <% cta_href = @cta_url&.start_with?("http") ? @cta_url : "#{root_url.chomp('/')}#{@cta_url}" %>
        <%= link_to @cta_text, cta_href, style: "display: inline-block; padding: 10px 28px; background-color: #3f3f46; color: #ffffff; text-decoration: none; border-radius: 6px; font-size: 14px; font-weight: 500;" %>
      </div>
    </div>

    <%# Footer %>
    <div style="margin-top: 24px; font-size: 12px; color: #94a3b8; text-align: center; line-height: 1.5;">
      You're receiving this because you have email notifications enabled for <%= @project.name %>.
      <br>
      You can change your preferences in project settings.
    </div>
  </div>
</body>
</html>
